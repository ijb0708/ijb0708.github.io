# MetalLB란 무엇인가: 왜 필요한가?

## 개요

MetalLB는 베어메탈 또는 프라이빗 환경에서 Kubernetes 클러스터에 외부 IP를 할당할 수 있도록 해주는 로드밸런서 솔루션이다. 
대부분의 클라우드 환경에서는 `Service` 리소스에 `type: LoadBalancer`를 선언하면 클라우드 벤더(AWS, GCP 등)가 자동으로 외부 IP를 부여하고, 외부에서 해당 **서비스**에 접근할 수 있도록 해준다. 하지만 로컬 서버나 온프레미스 환경에서는 그런 **IP 할당 서비스**가 없기 때문에, 
`LoadBalancer` 타입은 의미가 없어진다. 이를 해결하기 위해 MetalLB가 사용된다.

> 서비스에서 할당하기 위한용도이다

## Kubernetes의 기본 Service 타입들

Kubernetes에서는 일반적으로 세 가지 유형의 Service를 사용한다:

- `ClusterIP`: 클러스터 내부에서만 접근 가능
    
- `NodePort`: 클러스터 외부에서 노드 IP + 고정 포트로 접근 가능
    
- `LoadBalancer`: 외부 IP를 할당받아 외부에서 바로 접속 가능 (클라우드 환경 전용)
    

로컬에서는 일반적으로 `NodePort` 방식을 사용하지만, 이 방식은 몇 가지 단점이 존재한다.

## NodePort 방식의 한계

NodePort 방식은 다음과 같은 문제를 가지고 있다:

- 접근 시 포트 번호를 외워야 한다 (예: 192.168.0.10:30080)
    
- 여러 서비스가 있을 경우 포트 번호가 충돌할 수 있다
    
- 노드 IP가 바뀌거나, 어떤 노드를 거쳐야 하는지 불분명하다
    
- DNS 연결이 어렵다 (포트까지 매핑 필요)
    

이러한 한계를 해결하고, 클라우드 수준의 진입 구조를 로컬에서도 구현하기 위해 MetalLB가 등장한다.

## MetalLB의 주요 기능

MetalLB는 다음과 같은 기능을 제공한다:

1. `type: LoadBalancer` 서비스에 외부 IP 자동 할당
    
2. Layer 2 (ARP) 또는 Layer 3 (BGP) 방식으로 IP 광고
    
3. 클러스터 외부에서 DNS 설정 없이 IP만으로도 서비스 접근 가능
    
4. IP 충돌을 방지하기 위한 풀(pool) 기반 IP 할당
    

## Layer2 방식과 IP 할당 원리

Layer2 방식은 가장 단순한 설정 방식이다. MetalLB는 특정 노드의 NIC를 통해 ARP 광고를 보내며 "이 IP는 나한테 있다"고 알려준다. 라우터 및 네트워크 상 다른 장비들은 그 ARP 응답을 바탕으로 해당 IP를 그 노드로 라우팅하게 된다.

예를 들어, `10.1.1.240`을 MetalLB가 Traefik에 할당했다면, 네트워크 상에서는 해당 IP가 Traefik이 있는 노드에 존재하는 것처럼 인식된다. 실제로는 K8s 내부 서비스에 연결되는 것이지만, 외부 입장에서는 단일 고정 IP로 보이기 때문에 DNS 구성이나 포트포워딩 없이 바로 접근이 가능하다.

## MetalLB가 필요한 이유

### 1. 외부에서 접속 가능한 고정 IP 제공

NodePort는 여러 노드 중 어떤 것에 접속해야 하는지 명확하지 않다. 반면 MetalLB는 단일 IP를 서비스 리소스에 할당함으로써 일관된 진입점을 제공한다.

### 2. 포트 충돌 및 관리 복잡도 감소

여러 NodePort를 사용하다 보면 포트 충돌이나 관리 복잡도가 생긴다. MetalLB는 포트가 아니라 IP 단위로 구분되기 때문에 구조적으로 훨씬 명확하다.

### 3. DNS 연동이 간편함

LoadBalancer로 외부 IP가 할당되면 도메인을 해당 IP로 단순하게 매핑할 수 있다. NodePort 방식처럼 복잡한 포트 설정이 필요 없다.

### 4. 실서비스 운영 수준의 네트워크 구조 구축 가능

MetalLB는 클라우드 환경에서 가능한 구조를 로컬에서도 실현할 수 있게 해준다. 운영환경과 유사한 테스트 환경을 로컬에서 구현하고 싶은 경우 필수적인 구성 요소다.

## 실전 구성 예시

- pfSense 라우터 환경에서 DHCP 범위를 제외한 대역을 MetalLB에 할당 (예: `10.1.1.240-10.1.1.250`)
    
- Traefik을 `type: LoadBalancer`로 설치
    
- MetalLB가 Traefik 서비스에 외부 IP 자동 부여
    
- 브라우저에서 `http://10.1.1.240`으로 Dashboard 접근 가능
    

## 결론

MetalLB는 로컬/온프레미스 Kubernetes 환경에서 클라우드 수준의 네트워크 구성을 가능하게 해주는 필수 컴포넌트다. 특히 진입점이 명확하고, DNS 연동이 쉬우며, 구성과 운영이 직관적인 IP 기반 구조를 만들 수 있다. 로컬 클러스터를 실전 환경처럼 구성하고 싶다면 MetalLB는 반드시 고려해야 할 솔루션이다.